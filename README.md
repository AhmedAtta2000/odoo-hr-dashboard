# ESS SaaS Portal - Employee Self-Service Portal

This project is a comprehensive, multi-tenant Employee Self-Service (ESS) SaaS Portal. It provides employees with access to their HR information by securely connecting to a backend Odoo instance. The system is architected with a React frontend, a FastAPI backend acting as middleware, and a custom Odoo Connector module.

## Features

### Employee Self-Service Portal
- **Secure Login:** JWT-based authentication with Access and Refresh tokens.
- **Two-Factor Authentication (2FA):** Time-based One-Time Password (TOTP) for enhanced security.
- **Password Reset:** Secure "Forgot Password" flow via email.
- **Dashboard:** At-a-glance view of pending leaves, next day off, and latest payslip status.
- **My Profile:** View detailed employee information synced directly from Odoo.
- **Leave Management:** View available leave types from Odoo and submit new leave requests.
- **Payslips:** View a list of payslips and download PDF copies generated by Odoo.
- **Expenses:** Submit new expense claims with receipt attachments, which are created in Odoo.
- **Documents:** Upload and download personal documents (e.g., ID, contracts) which are attached to the employee record in Odoo.
- **Attendance:** View live check-in/out status, perform check-in/out actions, and view a log of today's attendance records, all synced with Odoo's `hr.attendance`.

### SaaS Admin Panel
- **Tenant Management:** Admins can list, create, and activate/deactivate tenants.
- **Odoo Configuration:** Securely configure Odoo connection details (URL, DB, API User, API Token) for each tenant.
- **Odoo Connection Testing:** A "Test Connection" feature to validate Odoo credentials.
- **SaaS User Management:** Admins can list, create, edit, and delete SaaS portal users, and link them to their corresponding Odoo employee records.

### Odoo Connector Module (`odoo_ess_connector`)
- Provides a secure REST API for the FastAPI backend to interact with Odoo.
- **API Token Management:** Odoo users can generate and manage their own API tokens via the Odoo UI.
- **Settings:** Odoo admins can enable/disable the integration and configure an IP whitelist.
- **Scope Control:** API tokens can be scoped to allow access only to specific models.
- **API Call Logging:** All API calls to the connector are logged within Odoo for auditing.

## Technology Stack

- **Frontend:** [React](https://reactjs.org/) with [Material UI (MUI)](https://mui.com/) for components.
- **Backend (Middleware):** [FastAPI](https://fastapi.tiangolo.com/) (Python).
- **SaaS Database:** [PostgreSQL](https://www.postgresql.org/).
- **Odoo Connector:** Custom Odoo module (Python, XML).
- **Authentication:** JWT (Access & Refresh Tokens), `python-passlib` (for hashing).
- **Credential Encryption:** Fernet from `cryptography` library.
- **API Rate Limiting:** `slowapi`.
- **Email:** `fastapi-mail`.

## Setup and Installation

Follow these steps to set up and run the project locally for development.

### Prerequisites
- **Git:** For cloning the repository.
- **Node.js:** v18.x or later.
- **Python:** v3.10 or later.
- **PostgreSQL:** A running instance for the SaaS database.
- **Odoo Instance:** A running Odoo instance (v16, v17, or v18) for the connector module, either locally (e.g., via Docker) or on a platform like Odoo.sh. The Odoo instance should have the standard HR modules (`hr`, `hr_holidays`, `hr_attendance`, `hr_payroll`, `hr_expense`) installed.
- **An Email Catcher (Recommended for Dev):** A tool like [MailHog](https://github.com/mailhog/MailHog) to catch password reset emails locally.

### 1. Clone the Repository
```bash
git clone <your-repository-url>
cd ess-saas-portal
```

### 2. Odoo Connector Setup
1.  Copy the `odoo_ess_connector` directory into the `addons` path of your Odoo instance.
2.  Restart your Odoo server.
3.  Log in to Odoo as an administrator.
4.  Go to `Apps`, click `Update Apps List`.
5.  Search for "Odoo ESS Connector" and click `Install`.
6.  Navigate to the settings (e.g., Administration -> ESS API Tokens) to generate an API token for the Odoo user who will be used for the integration (e.g., `admin` or a dedicated API user). This user must have appropriate HR group permissions (e.g., HR Officer) to view other employees' data.
7.  Copy the generated Odoo API token.

### 3. Backend (FastAPI) Setup
1.  Navigate to the `backend` directory:
    ```bash
    cd backend
    ```
2.  Create and activate a Python virtual environment:
    ```bash
    # Windows
    python -m venv venv
    .\venv\Scripts\activate

    # macOS / Linux
    python3 -m venv venv
    source venv/bin/activate
    ```
3.  Install the required Python packages:
    ```bash
    pip install -r requirements.txt
    ```
4.  Create and configure the `.env` file. Copy the example file:
    ```bash
    # Windows
    copy .env.example .env

    # macOS / Linux
    cp .env.example .env
    ```
5.  **Edit the `backend/.env` file** and fill in all the required values:
    - `DATABASE_URL`: Your connection string for the SaaS PostgreSQL database.
    - `SECRET_KEY`: A strong, random string for JWTs.
    - `CREDENTIAL_ENCRYPTION_KEY`: The Fernet key you generate for encrypting Odoo credentials.
    - `FRONTEND_URL`: `http://localhost:3000` (or your frontend's port).
    - `MAIL_...`: Your SMTP or local email catcher (e.g., MailHog) settings.

6.  Run the database migrations using Alembic:
    ```bash
    alembic upgrade head
    ```
7.  **Populate Initial Data:**
    - Connect to your SaaS PostgreSQL database.
    - Create a default tenant (e.g., `INSERT INTO tenants (name) VALUES ('Default Tenant');`).
    - Create a record in `odoo_credentials` for that tenant, including the Odoo URL and the **encrypted** version of the API token you copied from Odoo.
    - Create a SaaS admin user (e.g., `test@example.com`) and link them to the tenant. Set `is_admin = TRUE`.

### 4. Frontend (React) Setup
1.  Navigate to the `frontend` directory in a new terminal:
    ```bash
    cd frontend
    ```
2.  Install the required Node.js packages:
    ```bash
    npm install
    ```

---

## Running the Application

You will need two separate terminals open to run the backend and frontend servers simultaneously.

### 1. Run the Backend Server
- In a terminal in the `backend` directory with the `venv` activated:
```bash
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```
- The backend API will be available at `http://localhost:8000`.

### 2. Run the Frontend Server
- In a separate terminal in the `frontend` directory:
```bash
npm start
```
- The React development server will start, and the application should open in your browser at `http://localhost:3000`.

### Accessing Tools (if set up)
- **MailHog Web UI:** `http://localhost:8025` (to view password reset emails).
- **FastAPI Docs:** `http://localhost:8000/docs` (interactive API documentation).

You can now log in to the ESS Portal with the SaaS admin user you created and start using the application!
